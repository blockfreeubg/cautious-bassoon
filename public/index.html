<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>BlockFree</title>

<link rel="shortcut icon" href="favicon.webp">

<script src="/scram/scramjet.all.js"></script>
<script src="/baremux/index.js"></script>
<script src="register-sw.js" defer></script>
<script src="search.js" defer></script>
<script src="index.js" defer></script>

<style>
html, body {
    height:100%;
    margin:0;
    background:#202124;
    font-family:system-ui;
    color:white;
    overflow:hidden;
}

.app {
    height:100%;
    display:flex;
    flex-direction:column;
}

/* Tabs */
.tabs {
    height:38px;
    background:#171717;
    display:flex;
    align-items:center;
    padding:0 8px;
    gap:6px;
}

.tab {
    background:#2b2b2b;
    padding:6px 12px;
    border-radius:10px 10px 0 0;
    display:flex;
    align-items:center;
    gap:8px;
    cursor:pointer;
}

.tab.active {
    background:#3c4043;
}

.close {
    font-size:12px;
    opacity:.7;
    cursor:pointer;
}

.new-tab {
    font-size:20px;
    padding:0 8px;
    cursor:pointer;
}

/* Address bar */
.browser-bar {
    height:48px;
    background:#2b2b2b;
    display:flex;
    align-items:center;
    padding:0 12px;
}

#sj-form {
    flex:1;
    display:flex;
}

#sj-address {
    width:100%;
    height:34px;
    border-radius:18px;
    border:none;
    padding:0 14px;
    background:#3c4043;
    color:white;
    font-size:14px;
    outline:none;
}

/* Page view */
.view-area {
    flex:1;
    position:relative;
}

.view-area iframe {
    position:absolute;
    width:100%;
    height:100%;
    border:none;
    display:none;
}

.view-area iframe.active {
    display:block;
}
</style>
</head>

<body>
<div class="app">

<div class="tabs" id="tabs">
    <div class="new-tab" onclick="createTab()">+</div>
</div>

<div class="browser-bar">
<form id="sj-form">
<input id="sj-search-engine"
value="https://www.google.com/search?q=%s"
type="hidden">
<input id="sj-address" placeholder="Search or enter URL">
</form>
</div>

<div class="view-area" id="views"></div>

</div>

<script>
let tabCount = 0;
let activeTab = null;

function createTab(url="about:blank") {
    tabCount++;

    const tabId = "tab"+tabCount;

    // tab button
    const tab = document.createElement("div");
    tab.className = "tab active";
    tab.dataset.id = tabId;
    tab.innerHTML = `
        Tab ${tabCount}
        <span class="close">âœ•</span>
    `;

    document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));
    document.querySelectorAll("iframe").forEach(f=>f.classList.remove("active"));

    document.getElementById("tabs").prepend(tab);

    // iframe view
    const frame = document.createElement("iframe");
    frame.src = url;
    frame.className = "active";
    frame.dataset.id = tabId;
    document.getElementById("views").appendChild(frame);

    activeTab = tabId;

    tab.onclick = e=>{
        if(e.target.classList.contains("close")){
            frame.remove();
            tab.remove();
            return;
        }

        document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));
        document.querySelectorAll("iframe").forEach(f=>f.classList.remove("active"));

        tab.classList.add("active");
        frame.classList.add("active");
        activeTab = tabId;
    };
}

createTab();

/* Hook search form */
document.getElementById("sj-form").onsubmit = e=>{
    e.preventDefault();

    let url = document.getElementById("sj-address").value.trim();

    if(!url.startsWith("http"))
        url = "https://"+url;

    const frame = document.querySelector(`iframe[data-id="${activeTab}"]`);
    if(frame) frame.src = url;
};
</script>

</body>
</html>
